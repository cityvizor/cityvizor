<div class="row">

	<div class="col-lg-12">
		
		<!-- VIZUALIZACE -->
		<div id="bigbang" #drawing>

			<div class="whiteTransitions">
				<div class="topTransition"></div><div class="bottomTransition"></div>
			</div>

			<budgets-list [profile]="profile?._id" type="income" [selected]="state?.year" (select)="selectBudget($event)"></budgets-list>
			
			<div class="row">
				<div class="col-lg-8 offset-lg-2">
					<div class="box ratio2_1">
						<div class="content">
							<chart-bigbang [data]="groups" [max]="maxAmount" [selected]="state.group" [hovered]="hoveredGroup" (select)="selectGroup($event)" (hover)="hoveredGroup=$event"></chart-bigbang>
						</div>
					</div>
				</div>
			</div>

		</div>

		<!-- vyber skupiny -->
		
		<div class="btn-group-selected">
			<div class="btn-group">
				
				<div class="btn-group" dropdown>
					<button dropdownToggle type="button" class="btn btn-lg btn-red dropdown-toggle">
						<strong *ngIf="state.group">{{groupIndex[state.group].title}}</strong>
						<strong *ngIf="!state.group">Vybrat skupinu</strong> <span class="caret"></span>
						<div class="arrow_groupselecthint" *ngIf="!state.group">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 81.99 29.28"><defs><style>.cls-1{fill:#c4c4c4;}</style></defs><title>Klikněte zde</title><g id="Vrstva_2" data-name="Vrstva 2"><g id="Vrstva_1-2" data-name="Vrstva 1"><g id="Vrstva_2-2" data-name="Vrstva 2"><g id="Vrstva_1-2-2" data-name="Vrstva 1-2"><path class="cls-1" d="M36.66,27a24,24,0,0,1-11.77-2.55,36.43,36.43,0,0,1-5.33-3.16,28.77,28.77,0,0,1-4.58-4,31.2,31.2,0,0,1-4.72-6.63c-.17-.32-.33-.66-.49-1s-.33-.66-.47-1C9,7.9,8.7,7.2,8.46,6.41c-.12-.39-.27-.76-.38-1.16L8,4.78V4.72h0l.05,0,.16,0,.31.05a8,8,0,0,0,2.63-.06L24.85,8.25l-12.9-6L8.12.5,8,.44l-.2.47L7.94.53,8,.44H8l-.05,0L7.69.26,7.5.18,7.26.08A.82.82,0,0,0,6.77,0a1.07,1.07,0,0,0-.25.12L6.4.2,6.27.33,6,.61A2.92,2.92,0,0,0,5.8,1c-.15.31-.29.63-.41,1l-.19.5-.1.27c-.51,1.39-1,2.74-1.44,4.09,0,0,.65-1.47.16,0C1.9,12.71,2,12.68,2.13,12.72s1.49-4.42,1-2.95c.75-2.21,1.76-5.16,2.45-7,.09-.21.19-.48.28-.71s.16-.39.25-.57a2.72,2.72,0,0,1,.2-.35c.06-.1.11-.07.13-.08s0,0,0,0-.06,0-.13.11a8,8,0,0,0-.52,1.22c-.53,1.51-2.58,7.38-3,8.86s.66-1.46.24,0l-1,3c-.38,1.11-.73,2.2-1,3s-.07.37.09,0l.21-.43s0,0,0,.07a3.7,3.7,0,0,1-.14.38c-.1.27-.2.54-.29.81q-.06.16-.1.33h0l-.15,0a.81.81,0,0,0-.24.09s-.05.05,0,0,0,0,0,0a.23.23,0,0,0,0-.1s0-.08-.07-.11l-.09-.11,0-.05h0l0-.07c.23-.48.49-1.1.75-1.7.52-1.22,1-2.53,1.58-3.88C3.55,9.74,4.65,6.83,5.7,3.9c0,0,.42-1.48-.66,1.44C3.8,8.73,2.5,12.13,1.11,15.46c-.35.82-.72,1.68-1,2.4L0,18l0,0H0l.17.19a.62.62,0,0,1,.11.16l0,.06s0,.06,0,.06,0,0,0,0l.14-.07a1.28,1.28,0,0,1,.21-.05l.25,0H1l.19-.53.23-.61a3.91,3.91,0,0,0,.14-.37l.12-.35,1.76-5.19Q4.3,8.72,5.19,6.15c.3-.86.6-1.71.9-2.56L6.32,3l.11-.29s0-.1.06-.09h0l.14.06.16.05L7,2.79l.31.13,1.21.56,2.41,1.13.81-2.33a7.18,7.18,0,0,1-2.37,0l-.28-.05-.14,0-.27-.08L8.4,2.08,8.12,2l-.27-.12a1.49,1.49,0,0,1-.29-.15C6.8,1.28,5.9.69,5.12.22L5.2.67l.11.54.24,1.11L6,4.63l.11.54.06.27.08.27.27,1,.15.59.18.54.37,1.08c.12.36.27.69.41,1s.27.68.42,1l.46.95a29.64,29.64,0,0,0,4.36,6.5,33.13,33.13,0,0,0,5.28,4.81A38.86,38.86,0,0,0,24,26.8,24.53,24.53,0,0,0,30.55,29a24.79,24.79,0,0,0,7.28.08,30.11,30.11,0,0,0,7.86-2.13A39,39,0,0,0,54,22.13c1.9-1.53,2.14-1.79,1.55-1.38-.3.2-.8.56-1.41,1s-1.31.87-2,1.33c.94-.62,1-.75,1.89-1.38,0-.06-.47.18-1.4.76s-2.32,1.38-4.15,2.33c.92-.52,1.84-1,2.77-1.59s0-.14,0-.24c-.46.29-.93.59-1.27.76a2.91,2.91,0,0,1-.57.28l0-.19.82-.46c.32-.17.66-.41,1-.62l1-.62.85-.62c-.46.33-.92.65-1.27.86a3.24,3.24,0,0,1-.57.32v-.19l-.73.46-.78.44c-.54.29-1.11.65-1.67.9s-1.12.56-1.66.79-1,.43-1.47.59l0-.15,1.47-.62c.53-.21,1.09-.52,1.65-.77s1.13-.59,1.66-.86l.78-.44.73-.47c-.91.53-.9.48-.9.38a30.18,30.18,0,0,1-8,3.39c.42-.1.86-.25,1.3-.4s.87-.28,1.31-.45c-.43.1-1,.26-1.71.48s-1.45.38-2.26.6l-1.19.24a10.41,10.41,0,0,1-1.18.21A15.08,15.08,0,0,1,36.66,27Z"/></g></g><path class="cls-1" d="M57.95,6.66l-.69.08-1.31.18A6.3,6.3,0,0,1,54.6,7a3.25,3.25,0,0,1-.47-.06A.8.8,0,0,1,53.53,6a1.24,1.24,0,0,1,.26-.69,21.53,21.53,0,0,0,1.7-2.25.69.69,0,0,0,.1-.26c0-.06,0-.08-.08-.09-.25,0-.56.31-.87.29s-.74-.39-.72-.72a.52.52,0,0,1,.38-.41,7.94,7.94,0,0,1,1.6-.33,4,4,0,0,1,.71-.13c.35,0,.47.37.45.67C57,3.26,54.89,5.35,54.86,5.71c0,.07.11.08.17.08h0c.85.06,1.71-.26,2.57-.25h.06c.32,0,.58.49.56.8A.32.32,0,0,1,57.95,6.66Z"/><path class="cls-1" d="M64.51,7c-.56,0-.86-.58-1-1.06a5.38,5.38,0,0,0-.27-.79A.25.25,0,0,0,63,5a.19.19,0,0,0-.17.07c-.12.14-.23.31-.34.45a3.86,3.86,0,0,1-1.73,1.28,2.83,2.83,0,0,1-1.13.2,1.18,1.18,0,0,1-1.2-1.19,1.05,1.05,0,0,1,.26-.61,11.26,11.26,0,0,1,3.75-2.37c.09,0,.25-.1.26-.21A12.13,12.13,0,0,0,62.58.54V.46A.41.41,0,0,1,63.05.1a.53.53,0,0,1,.36.17A2.35,2.35,0,0,1,64.13,2c0,1.15-.17,3.48.94,4.16.13.08.31.18.3.36S64.78,7,64.51,7ZM62.46,3.93l-.07,0a9.44,9.44,0,0,0-2.7,1.65.25.25,0,0,0-.06.15c0,.17.1.25.26.26a1.08,1.08,0,0,0,.33,0A5.86,5.86,0,0,0,62.5,4.11a.24.24,0,0,0,0-.09A.08.08,0,0,0,62.46,3.93Z"/><path class="cls-1" d="M71.54,7.8a4,4,0,0,1-2,.32,4.17,4.17,0,0,1-1.32-.28c-.92-.37-2.14-1-2.06-2.17a2.94,2.94,0,0,1,0-.33,3.33,3.33,0,0,1,2-2.2,3.65,3.65,0,0,1,1.95-.54c.71,0,1.64.48,1.58,1.31a1.25,1.25,0,0,1-.44.85c-.76.64-1.52.55-2.38.87a2.63,2.63,0,0,1-1,.17.6.6,0,0,1-.54-.3v0s0,.11,0,.13c-.05.74,1,1.08,1.53,1.26a4.21,4.21,0,0,0,1.09.23,8.33,8.33,0,0,0,1.34-.06h.1a.38.38,0,0,1,.36.42A.34.34,0,0,1,71.54,7.8ZM70.33,3.68a3.07,3.07,0,0,0-.46,0,4.54,4.54,0,0,0-2.29,1s-.05.06-.05.09,0,0,0,0h0a12.15,12.15,0,0,1,1.34-.23c.3,0,1.59-.32,1.61-.68A.21.21,0,0,0,70.33,3.68Z"/><path class="cls-1" d="M47.31,17.66a.51.51,0,0,1-.26-.1,8.85,8.85,0,0,0-1-.62c-.82-.41-1.71-.67-2.54-1.08a.64.64,0,0,0-.2-.06.1.1,0,0,0-.13.09,2.07,2.07,0,0,0-.09.39,2.44,2.44,0,0,1-.43,1.18.65.65,0,0,1-.57.28.43.43,0,0,1-.42-.49,1,1,0,0,1,0-.19,11.48,11.48,0,0,0,.61-2.82,21.19,21.19,0,0,0-.25-4,.47.47,0,0,1,0-.13.67.67,0,0,1,.74-.6.54.54,0,0,1,.52.63l0,.26a17.25,17.25,0,0,0,.06,2.1c0,.31,0,.61,0,.93,0,0,0,.13.06.14a.26.26,0,0,0,.12,0,7.81,7.81,0,0,0,2.06-1.44,11.16,11.16,0,0,1,1.09-.91.39.39,0,0,1,.26-.08.64.64,0,0,1,.57.63c0,.68-1.91,1.68-2.46,2a6,6,0,0,0-1,.77v0s.08,0,.09.05a7.28,7.28,0,0,0,.9.57,6.44,6.44,0,0,1,2.54,1.54.69.69,0,0,1,.15.48C47.72,17.43,47.57,17.67,47.31,17.66Z"/><path class="cls-1" d="M49.72,15.75c0,.31-.06.63-.11.93a.37.37,0,0,1-.44.31.65.65,0,0,1-.6-.5,4.87,4.87,0,0,1,0-1.18c0-.65.19-1.28.23-1.93a12.6,12.6,0,0,0-.49-3.56.47.47,0,0,1,0-.18c0-.41.57-.55.92-.53s.59.15.6.51c0,1,.21,2.08.21,3.14,0,.41,0,.81,0,1.2C49.88,14.56,49.8,15.15,49.72,15.75Z"/><path class="cls-1" d="M52.37,11.56a1.4,1.4,0,0,1-1.51-.85.45.45,0,0,1-.07-.26c0-.3.35-.41.62-.39s1.55.47,1.52,1A.68.68,0,0,1,52.37,11.56Zm-.22,5.77a.67.67,0,0,1-.48-.2,2.29,2.29,0,0,1-.58-1.48c0-.61,0-1.21.09-1.82l.06-.81a.39.39,0,0,1,.45-.4.82.82,0,0,1,.76.79c0,.53-.23,1-.27,1.54-.08,1.14.81,1.68.78,2S52.41,17.34,52.16,17.33Z"/><path class="cls-1" d="M58.57,17.19a3.18,3.18,0,0,1-.76,0,12.59,12.59,0,0,1-2.07-.52l-.08,0c-.08,0-.15,0-.15.12,0,.29.38.81.36,1s-.32.25-.49.24-.65-.14-.74-.41a8.9,8.9,0,0,1-.51-2.7c0-.89.05-1.79,0-2.68a3.59,3.59,0,0,0-.52-2,.45.45,0,0,1-.08-.33.75.75,0,0,1,.7-.72.64.64,0,0,1,.34.13c.9.6.55,1.75.63,2.65a9.8,9.8,0,0,1,0,1.18,7.14,7.14,0,0,0,0,.89c0,.07,0,.16.11.16a.27.27,0,0,0,.2-.08c.5-.4,1.52-1.37,2.19-1.32a.61.61,0,0,1,.56.71c0,.29-.19.67-.53.65-.1,0-.17,0-.26-.05-.29,0-1.12.74-1.41.93,0,0-.19.11-.19.13s0,0,0,0a6.94,6.94,0,0,0,2.6,1,.41.41,0,0,1,.42.48A.54.54,0,0,1,58.57,17.19Z"/><path class="cls-1" d="M63.66,18.78a1,1,0,0,1-.36-.11c-1.08-.59-.44-2.13-.76-2.82,0-.06-.12-.29-.22-.29s-.09,0-.11.08c-.45.47-.47,1.23-1.08,1.57a.92.92,0,0,1-.5.14c-.45,0-.68-.61-.65-1v-.2a3.82,3.82,0,0,0-.4-2.11.36.36,0,0,1-.06-.22,1,1,0,0,1,.93-.78.62.62,0,0,1,.29.09c.4.26.26,1.55.36,2,0,.06,0,.22.12.23s.15-.07.19-.12a3.29,3.29,0,0,0,.75-1.2.34.34,0,0,1,.37-.19,1.07,1.07,0,0,1,.77.5,6.09,6.09,0,0,1,.37,2c0,.28,0,1.23.3,1.38a.57.57,0,0,1,.36.52A.61.61,0,0,1,63.66,18.78Z"/><path class="cls-1" d="M70.44,18.75a4,4,0,0,1-2,.32,4.17,4.17,0,0,1-1.31-.28c-.92-.37-2.14-1-2.06-2.17a2.89,2.89,0,0,1,0-.33,3.33,3.33,0,0,1,2-2.2A3.67,3.67,0,0,1,69,13.55c.71,0,1.64.48,1.58,1.31a1.26,1.26,0,0,1-.44.85c-.76.64-1.52.55-2.38.87a2.62,2.62,0,0,1-1,.17.6.6,0,0,1-.54-.3v0s0,.11,0,.13c-.05.74,1,1.08,1.53,1.26a4.19,4.19,0,0,0,1.09.23A8.34,8.34,0,0,0,70.15,18h.1a.37.37,0,0,1,.35.42A.34.34,0,0,1,70.44,18.75Zm-.22-7.07a8.34,8.34,0,0,0-1.16,1.39.89.89,0,0,1-.79.39.81.81,0,0,1-.69-.54,3.67,3.67,0,0,0-1.35-1.45.46.46,0,0,1-.17-.45c0-.3.25-.76.6-.74a.54.54,0,0,1,.34.18,12.73,12.73,0,0,0,1.47,1.45c.3,0,.95-1.18,1.6-1.14.23,0,.47.17.45.42A.83.83,0,0,1,70.22,11.68Zm-1,2.95a2.82,2.82,0,0,0-.46,0,4.54,4.54,0,0,0-2.29,1s-.05.06-.05.09,0,0,0,0h0a11.74,11.74,0,0,1,1.34-.23c.3,0,1.59-.32,1.61-.68A.2.2,0,0,0,69.23,14.63Z"/><path class="cls-1" d="M76.1,15.87a2.47,2.47,0,0,1-1.87.47l-.78-.08a.21.21,0,0,0-.24.16,4.61,4.61,0,0,0,.17,1.52,2.19,2.19,0,0,1,.21.77.62.62,0,0,1-.67.52c-.94-.07-.73-1.72-.74-2.35a2.6,2.6,0,0,0-.13-.75c-.1-.32-1-.33-.93-1a.56.56,0,0,1,.69-.56l.29,0a.21.21,0,0,0,.19-.08,14.46,14.46,0,0,1-.2-2.28.44.44,0,0,1,.53-.42c.41,0,.94.38.9.83a.64.64,0,0,1,0,.15,3.54,3.54,0,0,0-.2.92,6.39,6.39,0,0,0,0,1.07.21.21,0,0,0,.21.22c.3,0,.6.07.88.09a2.92,2.92,0,0,0,1.09-.06.88.88,0,0,1,.47-.17c.25,0,.36.29.35.52A.71.71,0,0,1,76.1,15.87Z"/><path class="cls-1" d="M81.82,19.56a4,4,0,0,1-2,.32,4.19,4.19,0,0,1-1.31-.28c-.92-.37-2.14-1-2.06-2.17a2.89,2.89,0,0,1,0-.33,3.33,3.33,0,0,1,2-2.2,3.66,3.66,0,0,1,1.95-.54c.71,0,1.64.48,1.58,1.31a1.26,1.26,0,0,1-.44.85c-.75.64-1.52.55-2.38.87a2.62,2.62,0,0,1-1,.17.6.6,0,0,1-.54-.3v0s0,.11,0,.13c-.05.74,1,1.08,1.53,1.26a4.19,4.19,0,0,0,1.09.23,8.33,8.33,0,0,0,1.34-.06h.1a.37.37,0,0,1,.35.42A.34.34,0,0,1,81.82,19.56Zm-1.21-4.12a2.82,2.82,0,0,0-.46,0,4.54,4.54,0,0,0-2.29,1s-.05.06-.05.09,0,0,0,0h0a12,12,0,0,1,1.34-.23c.3,0,1.59-.32,1.61-.68A.2.2,0,0,0,80.61,15.43Z"/></g></g></svg>
						</div>
					</button>
					<div *dropdownMenu class="dropdown-menu groupList" role="menu">
						<div class="dropdown-item" *ngFor="let group of groups" (mouseover)="hoveredGroup=group.id" (mouseout)="hoveredGroup=null" (click)="selectGroup(group.id)" [attr.class]="(hoveredGroup==group.id || state.group==group.id) ? 'group group-focus' : 'group'">
							<a>
								<div class="row">
									<div class="col-2">
										<div class="bar">
											<div class="bar-budget" [style.width]="(group.budgetAmount / maxAmount * 100)+'%'">
												<div class="bar-expenditure" [style.width]="(group.amount / group.budgetAmount * 100)+'%'">
												</div>
											</div>
										</div>
									</div>
									<div class="col-10 analytics" [attr.data-analytics]="group.id">
										{{group.title}} <sub class="text-muted hidden">{{group.id}}</sub>
									</div>
								</div>
							</a>
						</div>
					</div>
				</div>
				<button type="button" class="btn btn-lg btn-label">
					<div class="row">
						<div class="col-3 text-right">
							<strong>Rozpočet</strong>
						</div>
						<div *ngIf="state.group" class="col-9 font-number">
							{{groupIndex[state.group].budgetAmount | money:0:false}} Kč
						</div>
						<div *ngIf="!state.group" class="col-9 font-number">... Kč</div>
					</div>
					<div class="row">
						<div class="col-3 text-right">
							<strong>Plnění</strong>
						</div>
						<div *ngIf="state.group"  class="col-9 font-number">
							{{groupIndex[state.group].amount | money:0:false}} Kč
						</div>
						<div *ngIf="!state.group" class="col-9 font-number">... Kč</div>
					</div>
				</button>

			</div>
		</div>

		<div id="selectedGroup">

			<div *ngIf="groupIndex[state.group]">
				
				<div *ngIf="!groupIndex[state.group].items" class="text-muted text-center">
						<i class="fa fa-exclamation-circle fa-2x"></i>
						<p class="text-muted">Tato skupina není rozpočtována.</p>
				</div>
				
				<div *ngFor="let item of groupIndex[state.group].items" class="paragraph">

					<div class="row">
						<div class="col-md-12">
							<h4># {{item.id}} - {{itemNames[item.id] || ("Rozpočtová položka #" + item.id)}}</h4>
						</div>
					</div>

					<div class="row">
						<div class="col-sm-8">
							<div class="content">

								<table class="viztable table table-responsive">
									<thead>
										<tr>
											<th>{{ groupIndex[state.group].eventsColumnHeader }}</th>
											<th>Rozpočet</th>
											<th>Skutečné příjmy</th>
										</tr>
									</thead>
									<tbody>
										<tr *ngFor="let event of item.events">
											<td>
												<a *ngIf="event.event" (click)="selectEvent(event.event)">{{event.name}}</a>
												<span *ngIf="!event.event">{{event.name}}</span>
											</td>
											<td>{{event.budgetIncomeAmount | money:0:false}} Kč</td>
											<td>{{event.incomeAmount | money:0:false}} Kč</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>

						
						<div class="col-12 col-sm-4">
							<div class="row">
								<div class="col-12">
									<table class="table graftable table-responsive">
										<thead>
											<tr><th colspan=3>Stav plnění rozpočtu</th></tr>
										</thead>
										<tbody>
											<tr>
													<td rowspan=3><chart-donut [data]="getDonutChartData(item)"></chart-donut></td>
													<td>Rozpočet</td>
													<td class="text-right">{{item.budgetIncomeAmount | money:0:false}} Kč</td>
											</tr>
											<tr>
													<td><span style="color:#E73431;">&#9632;</span> Přijato</td>
													<td class="text-right">{{item.incomeAmount | money:0:false}} Kč</td>
											</tr>
											<tr *ngIf="item.incomeAmount <= item.budgetIncomeAmount">
													<td><span style="color:#ff9491;">&#9632;</span> Zbývá</td>
													<td class="text-right">{{item.budgetIncomeAmount - item.incomeAmount | money:0:false}} Kč</td>
											</tr>
											<tr *ngIf="item.incomeAmount > item.budgetIncomeAmount">
												<td colspan=3>
													<span class="label label-warning">Překročeno o {{item.incomeAmount - item.budgetIncomeAmount | money:0:false}} Kč</span>
												</td>
											</tr>
										</tbody>
									</table>
									
								</div>
							</div>
						</div>
						
					</div>					
				</div>
			</div>
		</div>

	</div>
</div>

<div bsModal #eventReceiptsModal="bs-modal" (onHide)="selectEvent(null)" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-body">
				<button type="button" class="close" (click)="selectEvent(null)" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				
				<event-detail [eventid]="state.event" (selectEvent)="selectEvent($event)" openTab="inc"></event-detail>
			</div>
		</div>
	</div>
</div>