<button class="btn btn-lg btn-default btn-infoModal pull-right"  (click)="infoModal.show();">
	<i class="fa fa-question-circle"></i>
</button>

<div class="row">

	<div class="col-lg-12">
		
		<!-- VIZUALIZACE -->
		<div id="bigbang" #drawing>

			<div class="whiteTransitions">
				<div class="topTransition" style=""></div><div class="bottomTransition" style=""></div>
			</div>

			<budgets-list [profile]="profile._id" type="income" [selected]="state.year" (select)="selectBudget($event)"></budgets-list>
			
			<div class="row">
				<div class="col-lg-8 col-lg-offset-2">
					<div class="box ratio2_1">
						<div class="content">
							<chart-bigbang [data]="groups" [max]="maxAmount" [selected]="state.group" [hovered]="hoveredGroup" (select)="selectGroup($event)" (hover)="hoveredGroup=$event"></chart-bigbang>
						</div>
					</div>
				</div>
			</div>

		</div>

		<!-- vyber skupiny -->
		
		<div class="btn-group-selected">
			<div class="btn-group">
				<button *ngIf="state.group" type="button" class="btn btn-lg btn-red">
							<strong>{{groupIndex[state.group].title}}</strong>
				</button>
				<button *ngIf="!state.group" type="button" class="btn btn-lg btn-red btn-initial">
						<strong>Vyberte skupinu...</strong>
						<div class="arrow_groupselecthint">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 237.02 41.58"><defs><style>.cls-1{fill:#dddddc;}</style></defs><title>Klikněte pro zobrazení seznamu...</title><g id="Vrstva_2" data-name="Vrstva 2"><g id="Vrstva_1-2" data-name="Vrstva 1"><path class="cls-1" d="M65.58,28a205.47,205.47,0,0,0,51.28,4.77c9-.18,17.92-.78,26.63-1.68a231.67,231.67,0,0,0,25.07-3.89,198.15,198.15,0,0,0,30.15-8.82c1.24-.47,2.44-1,3.67-1.52s2.46-1,3.65-1.58c2.39-1.15,4.82-2.23,7.13-3.54,1.16-.64,2.35-1.23,3.49-1.91l1.3-.79L218,9l.1-.08s.11-.07,0,0h-.24l-.7-.07-1.33-.15a58.07,58.07,0,0,1-10.38-2.27L189,1.23,206.26,1,224.59.71h.69c0,2.85,0,.54,0,1.06V.9c0-.2,0-.24,0-.2h0l.25,0L226.72.6l.91,0q.56,0,1.12,0a6.72,6.72,0,0,1,2.06.27,4.15,4.15,0,0,1,.79.43l.38.24a1.62,1.62,0,0,1,.29.36,5.51,5.51,0,0,1,.47.73,3.18,3.18,0,0,1,.25.92,11.41,11.41,0,0,1,0,2.16l-.09,1.11-.06.59c-.33,3.09-.78,6.05-1.23,9-.22,0-.07-3.34-.67-.1C228.55,29.16,228,29,227.61,29c-.22,0,1.61-9.68.85-6.5.79-4.85,1.8-11.32,2.17-15.42,0-.48.09-1.08.11-1.58a9.5,9.5,0,0,0,0-1.3,2.89,2.89,0,0,0-.19-.84c-.08-.24-.31-.23-.38-.26s-.1,0,0,0,.27,0,.34.32a8,8,0,0,1,0,2.76c-.44,3.32-2.31,16.23-3.2,19.41s-.14-3.33-1-.17l-1.08,6.46c-.38,2.44-.86,4.8-1,6.56-.25,1.58-.35.77-.42,0l-.1-1c0-.06,0,0-.07.14s-.05.42-.09.84c-.06.59-.13,1.2-.22,1.78a6.2,6.2,0,0,1-.14.71h0l.12,0a5.42,5.42,0,0,1,.54.17,3.68,3.68,0,0,1,.81.37c.06,0,.13.14.13.11s0-.08.09-.07a.92.92,0,0,1,.31-.16c.11,0,.31-.12.47-.16s.31-.07.54-.14l.24-.07v0l0-.16c-.1-1.1-.09-2.51-.08-3.87,0-2.76.15-5.7.33-8.73.35-6.07.93-12.55,1.75-19,.23,0,.84-3.17.17,3.29-.84,7.5-1.46,15.07-1.61,22.59,0,1.85,0,3.81.09,5.45l0,.25v.08h0l-.13,0c-.32.06-.66.15-1,.23a3.84,3.84,0,0,0-.73.22,1.56,1.56,0,0,0-.25.09c-.07,0-.16.11-.18.11s0,.09-.12,0a2.73,2.73,0,0,0-.45-.24c-.19-.07-.5-.21-.75-.27l-.95-.27h0v0c.05-.26.11-.74.16-1.16l.12-1.36c0-.24,0-.42.07-.82l.11-.78,1.86-11.38c.62-3.78,1.23-7.55,1.79-11.32.28-1.88.54-3.77.77-5.64l.15-1.39.06-.64c0-.07,0-.23-.08-.21h-.14l-.68,0L226,6c-.2,0-.68,0-.87,0l-1.44,0-5.77.09-11.55.19.76-5.13a52.82,52.82,0,0,0,9.42,2l1.2.13.6.06,1.22.08,1.23.08,1.29,0h1.29c.43,0,.94,0,1.4-.05,3.74-.18,8.34-.56,12.27-.83l-1.1.79-1.37.94-2.84,1.94L226,10.34l-1.38.94-.69.47-.77.46-2.81,1.7-1.61,1-1.66.89-3.31,1.77c-1.1.59-2.25,1.09-3.38,1.63s-2.26,1.08-3.4,1.59l-3.46,1.44a181.21,181.21,0,0,1-28.48,8.88A262.28,262.28,0,0,1,145.8,36q-14.75,1.64-29.56,2a219.1,219.1,0,0,1-29.7-1.18A186.35,186.35,0,0,1,57.38,31,160.54,160.54,0,0,1,29.66,20.48a127.59,127.59,0,0,1-25-16C-.33,0-.8-.7.85.57c.84.63,2.24,1.74,3.9,3.08s3.75,2.74,5.77,4.2C7.83,5.9,8,5.63,5.36,3.66c.1-.12,1.56.72,4.28,2.6s6.9,4.54,12.57,7.87c-2.79-1.74-5.65-3.38-8.31-5.32s.2-.28.32-.47c1.35.94,2.68,1.89,3.75,2.49a10.94,10.94,0,0,0,1.79,1l.24-.39L17.49,9.89c-1-.59-1.93-1.32-2.94-2l-2.92-2L9.3,4c1.28,1,2.55,2,3.58,2.68a10.89,10.89,0,0,0,1.73,1.08l.26-.37L17,8.86c.75.5,1.56,1,2.37,1.49,1.65,1,3.32,2.15,5.12,3.1s3.52,2,5.26,2.87S33.13,18,34.6,18.65l.14-.31-4.81-2.4c-1.73-.84-3.47-1.88-5.26-2.83s-3.49-2.05-5.14-3c-.81-.51-1.63-1-2.37-1.48L15.06,7.13C17.78,8.9,17.85,8.78,18,8.59a126.3,126.3,0,0,0,25.93,13c-1.52-.54-3-1.18-4.49-1.82s-3-1.25-4.44-1.93c1.52.55,3.61,1.32,6,2.31s5.15,1.92,8,3l4.35,1.44c1.46.48,2.9,1,4.34,1.36C60.49,26.71,63.19,27.57,65.58,28Z"/></g></g></svg>	
						</div>
				</button>
				<button type="button" class="btn btn-lg btn-label">
					<div class="row">
						<div class="col-xs-3 text-right">
							<strong>Rozpočet</strong>
						</div>
						<div *ngIf="state.group" class="col-xs-9 text-right">
							{{groupIndex[state.group].budgetAmount | money:0:false}} Kč
						</div>
						<div *ngIf="!state.group" class="col-xs-9 text-right"> Kč</div>
					</div>
					<div class="row">
						<div class="col-xs-3 text-right">
							<strong>Plnění</strong>
						</div>
						<div *ngIf="state.group"  class="col-xs-9 text-right">
							{{groupIndex[state.group].amount | money:0:false}} Kč
						</div>
						<div *ngIf="!state.group" class="col-xs-9 text-right"> Kč</div>
					</div>
				</button>

				<div class="btn-group" dropdown>
					<button dropdownToggle type="button" class="btn btn-lg btn-blue dropdown-toggle">
						Seznam <span class="caret"></span>
					</button>
					<ul *dropdownMenu class="dropdown-menu groupList" role="menu">
						<li role="menuitem" *ngFor="let group of groups" (mouseover)="hoveredGroup=group.id" (mouseout)="hoveredGroup=null" (click)="selectGroup(group.id)" [attr.class]="(hoveredGroup==group.id || state.group==group.id) ? 'group group-focus' : 'group'">
							<a>
								<div class="row">
									<div class="col-xs-2">
										<div class="bar">
											<div class="bar-budget" [style.width]="(group.budgetAmount / maxAmount * 100)+'%'">
												<div class="bar-expenditure" [style.width]="(group.amount / group.budgetAmount * 100)+'%'">
												</div>
											</div>
										</div>
									</div>
									<div class="col-xs-10 small analytics" [attr.data-analytics]="group.id">
										{{group.title}} <sub class="text-muted hidden">{{group.id}}</sub>
									</div>
								</div>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>

		<div id="selectedGroup">

			<div *ngIf="groupIndex[state.group]">
				
				<div *ngIf="!groupIndex[state.group].items" class="text-muted text-center">
						<i class="fa fa-exclamation-circle fa-2x"></i>
						<p class="text-muted">Tato skupina není rozpočtována.</p>
				</div>
				
				<div *ngFor="let item of groupIndex[state.group].items" class="paragraph">

					<div class="row">
						<div class="col-md-12">
							<h4># {{item.id}} - {{itemNames[item.id] || ("Rozpočtová položka #" + item.id)}}</h4>
						</div>
					</div>

					<div class="row">
						<div class="col-sm-8">
							<div class="content">

								<table class="viztable table table-responsive small">
									<thead>
										<tr>
											<th>{{ groupIndex[state.group].eventsColumnHeader }}</th>
											<th>Rozpočet</th>
											<th>Skutečné příjmy</th>
										</tr>
									</thead>
									<tbody>
										<tr *ngFor="let event of item.events">
											<td>
												<a *ngIf="event.event" (click)="selectEvent(event.event)">{{getEventName(event.event)}}</a>
												<span *ngIf="!event.event">{{getEventName(event.event)}}</span>
											</td>
											<td>{{event.budgetIncomeAmount | money:0:false}} Kč</td>
											<td>{{event.incomeAmount | money:0:false}} Kč</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>

						
						<div class="col-xs-8 col-xs-offset-2 col-sm-4 col-sm-offset-0">
							<div class="row">
								<div class="col-xs-12">
									<table class="table graftable table-responsive small">
										<thead>
											<tr><th colspan=3>Stav plnění rozpočtu</th></tr>
										</thead>
										<tbody>
											<tr>
													<td rowspan=3><chart-donut [data]="getDonutChartData(item)"></chart-donut></td>
													<td>Rozpočet</td>
													<td class="text-right">{{item.budgetIncomeAmount | money:0:false}} Kč</td>
											</tr>
											<tr>
													<td><span style="color:#E73431;">&#9632;</span> Přijato</td>
													<td class="text-right">{{item.incomeAmount | money:0:false}} Kč</td>
											</tr>
											<tr *ngIf="item.incomeAmount <= item.budgetIncomeAmount">
													<td><span style="color:#ff9491;">&#9632;</span> Zbývá</td>
													<td class="text-right">{{item.budgetIncomeAmount - item.incomeAmount | money:0:false}} Kč</td>
											</tr>
											<tr *ngIf="item.incomeAmount > item.budgetIncomeAmount">
												<td colspan=3>
													<span class="label label-warning">Překročeno o {{item.incomeAmount - item.budgetIncomeAmount | money:0:false}} Kč</span>
												</td>
											</tr>
										</tbody>
									</table>
									
								</div>
							</div>
						</div>
						
					</div>					
				</div>
			</div>
		</div>

	</div>
</div>

<div bsModal #eventReceiptsModal="bs-modal" (onHide)="selectEvent(null)" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-body">
				<button type="button" class="close" (click)="selectEvent(null)" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				
				<event-detail [eventid]="state.event" (selectEvent)="selectEvent($event)" openTab="inc"></event-detail>
			</div>
		</div>
	</div>
</div>

<div bsModal #infoModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" (click)="infoModal.hide()" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title">Jak se dělí příjmy?</h4>
			</div>
			<div class="modal-body">
				<p>
					Příjmy se dělí na účelové a neúčelové. Účelové příjmy jsou zpravidla vázány na konkrétní projekt (dotace národní či evropské či z jiných fondů, dary atd,). Neúčelové příjmy nejsou vázány na konkrétní projekt, zpravidla se jedná o příjmy z daní, příjmy na výkon státní správy atd. 
				</p>
			</div>
		</div>
	</div>
</div>